{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container-fluid py-4" style="background-color: #f8f9fa; min-height: 100vh;">

    <!-- Page Title -->
    <div class="text-center mb-4">
        <h2 class="fw-bold text-success">
            Tax & Deduction Report – {{ month }}/{{ year }}
        </h2>
    </div>

    <!-- Filters -->
    <div class="d-flex justify-content-center align-items-center gap-3 mb-4 flex-wrap">
        <form method="get" class="d-flex align-items-center gap-3">
            <div class="d-flex flex-column text-center">
                <label for="month" class="fw-semibold">Month</label>
                <input type="number" id="month" name="month" min="1" max="12"
                       value="{{ month }}" class="form-control form-control-sm text-center"
                       style="width: 80px;">
            </div>
            <div class="d-flex flex-column text-center">
                <label for="year" class="fw-semibold">Year</label>
                <input type="number" id="year" name="year"
                       value="{{ year }}" class="form-control form-control-sm text-center"
                       style="width: 100px;">
            </div>
            <button type="submit" class="btn btn-primary btn-sm mt-3">Filter</button>
        </form>

        <form method="get" action="{% url 'tax_deduction_report_pdf' %}" class="mt-3">
            <input type="hidden" name="month" value="{{ month }}">
            <input type="hidden" name="year" value="{{ year }}">
            <button type="submit" class="btn btn-success btn-sm">
                <i class="bi bi-file-earmark-pdf"></i> Download PDF
            </button>
        </form>
    </div>

    <!-- Table and Summary -->
    <div class="row justify-content-center">
        <div class="col-lg-9 col-md-10">
            <div class="table-responsive shadow-sm rounded-3">
                <table class="table table-bordered text-center align-middle mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th>Employee</th>
                            <th>PF (Rs)</th>
                            <th>ESI (Rs)</th>
                            <th>PT (Rs)</th>
                            <th>Income Tax (Rs)</th>
                            <th>Total Deductions (Rs)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for deduction in deductions %}
                        <tr>
                            <td>{{ deduction.employee.user.username }}</td>
                            <td>{{ deduction.pf|floatformat:2 }}</td>
                            <td>{{ deduction.esi|floatformat:2 }}</td>
                            <td>{{ deduction.pt|floatformat:2 }}</td>
                            <td>{{ deduction.income_tax|floatformat:2 }}</td>
                            <td class="fw-bold text-success">{{ deduction.total_deduction|floatformat:2 }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-muted">No records found for this month.</td>
                        </tr>
                        {% endfor %}
                        {% if totals %}
                        <tr class="table-success fw-bold">
                            <td>Totals</td>
                            <td>{{ totals.total_pf|floatformat:2 }}</td>
                            <td>{{ totals.total_esi|floatformat:2 }}</td>
                            <td>{{ totals.total_pt|floatformat:2 }}</td>
                            <td>{{ totals.total_income_tax|floatformat:2 }}</td>
                            <td>{{ totals.total_deduction|floatformat:2 }}</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Embedded CSS Fixes -->
<style>
    /* ✅ Make the layout responsive & aligned properly */
    body {
        overflow-x: hidden;
    }
    h2 {
        letter-spacing: 0.5px;
    }
    .table-responsive {
        max-width: 100%;
        overflow-x: auto;
    }
    table th, table td {
        vertical-align: middle !important;
        font-size: 0.95rem;
    }
    .btn {
        min-width: 100px;
    }
    .btn-success {
        background-color: #1ABC9C;
        border: none;
    }
    .btn-success:hover {
        background-color: #17A589;
    }
</style>

{% endblock %}




