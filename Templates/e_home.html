{% extends "layout.html" %}
{% load static %}
{% block title %}Employee | Dashboard | QuickPay{% endblock %}

{% block content %}
<div class="container-fluid p-3">
  
  <!-- ðŸ”¹ Top Scrolling Info -->
  <div class="bg-dark text-white py-2 px-3 mb-3 rounded">
  {% if notifications %}
    <marquee behavior="scroll" direction="left">
      {% for note in notifications %}
        ðŸ”” {{ note.message }} ({{ note.created_at|date:"M d, H:i" }}) &nbsp;&nbsp;&nbsp;
      {% endfor %}
    </marquee>
  {% else %}
    <p class="m-0 text-center">No new notifications</p>
  {% endif %}
</div>

  <div class="row">
    
    <!-- ðŸ”¹ Left Nav-Bar & News -->
    <div class="col-md-8">
      
      <!-- Sidebar Menu -->
      <div class="mb-3">
        <nav class="nav flex-column bg-light p-3 rounded shadow-sm">
          <a class="nav-link" href="{% url 'view_payslips' %}"> Payslips</a>
          <a class="nav-link" href="{% url 'add_leave' %}">Apply Leave</a>
          <a class="nav-link" href="{% url 'payment_history' %}">Payment History</a>
          <a class="nav-link" href="{% url 'submit_feedback' %}">Send Feedback</a>
          <a class="nav-link" href="{% url 'edit_profile' %}"> Profile</a>
          <a class="nav-link" href="{% url 'view_notifications' %}">Notifications</a>
          <a class="nav-link" href="{% url 'logout' %}" onclick="return confirm('Are you sure?')">Logout</a>
        </nav>
      </div>

      <!-- News / Updates -->
      <div class="card shadow-sm mb-3">
        <div class="card-header bg-primary text-white">Company News</div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <img src="{% static 'Copilot_20251003_152228.png' %}" class="img-fluid rounded mb-2">
              <p class="small">ðŸ“¢ HR announces new wellness program starting next week.</p>
            </div>
            <div class="col-md-6 mb-3">
              <img src="{% static 'Copilot_20251003_152901.png' %}" class="img-fluid rounded mb-2">
              <p class="small">ðŸŽ‰ Congratulations to Sales Team for exceeding Q3 targets!</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ðŸ”¹ Right Side: Clock & Calendar -->
    <div class="col-md-4">
      
      <!-- Live Clock -->
      <div class="card text-center shadow-sm mb-3">
        <div class="card-header bg-secondary text-white"></div>
        <div class="card-body">
          <h3 id="clock"></h3>
        </div>
      </div>

      <!-- Calendar -->
      <div class="card shadow-sm">
        <div class="card-header bg-info text-white">ðŸ“… Calendar</div>
        <div class="card-body">
          <div id="calendar"></div>
        </div>
      </div>
      
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // ðŸ”¹ Live Clock
  function updateClock() {
    const now = new Date();
    document.getElementById("clock").innerText = 
      now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
  }
  setInterval(updateClock, 1000);
  updateClock();

  // ðŸ”¹ Calendar with weekends highlighted
  function generateCalendar() {
    const today = new Date();
    const month = today.toLocaleString('default', { month: 'long' });
    const year = today.getFullYear();
    const firstDay = new Date(year, today.getMonth(), 1).getDay();
    const daysInMonth = new Date(year, today.getMonth() + 1, 0).getDate();

    let html = `<h5 class="text-center">${month} ${year}</h5>
                <table class="table table-bordered text-center">
                <tr>`;

    const days = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    for (let d of days) html += `<th>${d}</th>`;
    html += "</tr><tr>";

    // Empty cells before first day
    for (let i = 0; i < firstDay; i++) html += "<td></td>";

    // Days of month
    for (let day = 1; day <= daysInMonth; day++) {
      const currentDay = new Date(year, today.getMonth(), day).getDay(); // 0 = Sun, 6 = Sat
      let cellClass = "";

      // Highlight weekends
      if (currentDay === 0 || currentDay === 6) {
        cellClass = "bg-danger text-white";
      }
      // Highlight today
      if (day === today.getDate()) {
        cellClass = "bg-warning fw-bold";
      }

      html += `<td class="${cellClass}">${day}</td>`;

      if ((firstDay + day) % 7 === 0) html += "</tr><tr>";
    }

    html += "</tr></table>";
    document.getElementById("calendar").innerHTML = html;
  }

  generateCalendar();
</script>
{% endblock %}
