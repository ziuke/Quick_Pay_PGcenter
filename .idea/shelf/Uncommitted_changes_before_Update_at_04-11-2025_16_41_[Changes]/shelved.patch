Index: Templates/base.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>QuickPay</title>\r\n    {% load static %}\r\n    <!-- Bootstrap CSS -->\r\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n    <!-- Custom Styles -->\r\n    <link rel=\"stylesheet\" href=\"{% static 'css/mystyle.css' %}\">\r\n</head>\r\n\r\n<body>\r\n    <div class=\"d-flex flex-column min-vh-100\">\r\n\r\n        <!-- ✅ Header with Navbar -->\r\n        <header>\r\n            <nav class=\"navbar navbar-expand-lg navbar-custom\">\r\n                <div class=\"container-fluid\">\r\n                    <!-- Brand -->\r\n                    <a class=\"navbar-brand fw-bold fs-2\"\r\n                       href=\"{% if request.user.is_superuser or request.user.role == 'admin' %}\r\n                                {% url 'admin_home' %}\r\n                              {% elif request.user.role == 'employee' %}\r\n                                {% url 'e_home' %}\r\n                              {% elif request.user.role == 'hr_manager' %}\r\n                                {% url 'h_home' %}\r\n                              {% elif request.user.role == 'payroll_manager' %}\r\n                                {% url 'pr_home' %}\r\n                              {% else %}\r\n                                {% url 'home' %}\r\n                              {% endif %}\">\r\n                        QuickPay\r\n                    </a>\r\n\r\n                    <!-- Navbar Toggler (for mobile) -->\r\n                    <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"collapse\"\r\n                            data-bs-target=\"#navbarNav\" aria-controls=\"navbarNav\"\r\n                            aria-expanded=\"false\" aria-label=\"Toggle navigation\">\r\n                        <span class=\"navbar-toggler-icon\"></span>\r\n                    </button>\r\n\r\n                    <!-- Links -->\r\n                    <div class=\"collapse navbar-collapse\" id=\"navbarNav\">\r\n                        <ul class=\"navbar-nav ms-auto\">\r\n                            {% if request.user.is_authenticated %}\r\n                                {% if request.user.is_superuser or request.user.role == \"admin\" %}\r\n                                    <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'manage_users' %}\">Manage Users</a></li>\r\n                                    <li class=\"nav-item dropdown\">\r\n  <a class=\"nav-link dropdown-toggle\" href=\"#\" id=\"taxDropdown\" role=\"button\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n    Manage Taxes\r\n  </a>\r\n  <ul class=\"dropdown-menu\" aria-labelledby=\"taxDropdown\">\r\n    <li><a class=\"dropdown-item\" href=\"{% url 'view_pay_salary' %}\">View Allowances & Deductions</a></li>\r\n    <li><a class=\"dropdown-item\" href=\"{% url 'get_pay_salary' %}\">Add New Allowances and Deductions</a></li>\r\n  </ul>\r\n</li>\r\n                            <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'feedback_list' %}\">View Feedback</a></li>\r\n                            <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'view_notifications' %}\">Notifications</a></li>\r\n\r\n\r\n                                {% elif request.user.role == \"employee\" %}\r\n                                    <li class=\"nav-item\"><a class=\"nav-link\" href=\"#\">View Payslips</a></li>\r\n     <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'add_leave' %}\">Apply for Leave</a></li>\r\n                                    <li class=\"nav-item\"><a class=\"nav-link\" href=\"#\">Payment History</a></li>\r\n                                    <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'submit_feedback' %}\">Send Feedback</a></li>\r\n                                    <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'view_notifications' %}\">Notifications</a></li>\r\n                                    <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'edit_profile' %}\">Profile</a></li>\r\n\r\n                                {% elif request.user.role == \"payroll_manager\" %}\r\n                            <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'views_employees' %}\">View Employees</a></li>\r\n                            <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'views_pay_salary' %}\">Manage Taxes and Deductions</a></li>\r\n                            <li class=\"nav-item dropdown\">\r\n  <a class=\"nav-link dropdown-toggle\" href=\"#\" id=\"reportDropdown\" role=\"button\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n    Reports\r\n  </a>\r\n  <ul class=\"dropdown-menu\" aria-labelledby=\"reportDropdown\">\r\n    <li><a class=\"dropdown-item\" href=\"{% url 'payroll_summary' %}\">Payroll Report</a></li>\r\n    <li><a class=\"dropdown-item\" href=\"{% url 'tax_deduction_report' %}\">Taxes and Deduction Report</a></li>\r\n  </ul>\r\n                            <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'edit_profile' %}\">Profile</a></li>\r\n                            <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'view_notifications' %}\">Notifications</a></li>\r\n\r\n\r\n                                {% elif request.user.role == \"hr_manager\" %}\r\n\r\n                                    <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'view_employees' %}\">Manage Employees</a></li>\r\n                                   <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'manage_leaves' %}\">Manage Leaves</a></li>\r\n                                    <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'hr_view_pay' %}\">Current Allowances,\r\n                                        Taxes and Deductions</a></li>\r\n                                    <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'view_notifications' %}\">Notifications</a></li>\r\n                                    <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'edit_profile' %}\">Profile</a></li>\r\n\r\n\r\n                                {% endif %}\r\n\r\n                                <li class=\"nav-item\">\r\n                                    <a class=\"nav-link\" href=\"{% url 'logout' %}\" onclick=\"return confirm('Are you sure?')\">\r\n                                        Logout\r\n                                    </a>\r\n                                </li>\r\n                            {% else %}\r\n                                <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'about_us' %}\">About Us</a></li>\r\n                                <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'contact_us' %}\">Contact Us</a></li>\r\n                                <li class=\"nav-item\"><a class=\"nav-link\" href=\"{% url 'login' %}\">Login</a></li>\r\n                            {% endif %}\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n            </nav>\r\n        </header>\r\n\r\n        <!-- ✅ Main Content -->\r\n        <main class=\"flex-grow-1\">\r\n            {% block content %}\r\n            {% endblock %}\r\n        </main>\r\n\r\n        <!-- ✅ Toast Notifications -->\r\n        {% if messages %}\r\n        <div class=\"toast-container position-fixed bottom-0 end-0 p-3\" style=\"z-index: 9999;\">\r\n            {% for message in messages %}\r\n            <div class=\"toast align-items-center text-white bg-{% if message.tags == 'error' %}danger{% else %}success{% endif %} border-0 show\" role=\"alert\">\r\n                <div class=\"d-flex\">\r\n                    <div class=\"toast-body\">{{ message }}</div>\r\n                    <button type=\"button\" class=\"btn-close btn-close-white me-2 m-auto\" data-bs-dismiss=\"toast\"></button>\r\n                </div>\r\n            </div>\r\n            {% endfor %}\r\n        </div>\r\n        {% endif %}\r\n\r\n        <!-- ✅ Footer -->\r\n        <footer class=\"bg-secondary text-center py-3 mt-auto\">\r\n            <p class=\"mb-0\">© 2025 QuickPay. All Rights Reserved.</p>\r\n        </footer>\r\n    </div>\r\n\r\n    <!-- ✅ Scripts -->\r\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\r\n    <script>\r\n        document.querySelectorAll('.toast').forEach(t => new bootstrap.Toast(t).show());\r\n    </script>\r\n    {% block scripts %}{% endblock %}\r\n</body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Templates/base.html b/Templates/base.html
--- a/Templates/base.html	(revision d6f29e3645c12fdfbf321dd5eba251052fa69baf)
+++ b/Templates/base.html	(date 1762254428207)
@@ -56,14 +56,16 @@
     <li><a class="dropdown-item" href="{% url 'get_pay_salary' %}">Add New Allowances and Deductions</a></li>
   </ul>
 </li>
+                            <li class="nav-item"><a class="nav-link" href="{% url 'admin_analytics' %}">Admin Dashboard</a></li>
                             <li class="nav-item"><a class="nav-link" href="{% url 'feedback_list' %}">View Feedback</a></li>
                             <li class="nav-item"><a class="nav-link" href="{% url 'view_notifications' %}">Notifications</a></li>
 
 
                                 {% elif request.user.role == "employee" %}
-                                    <li class="nav-item"><a class="nav-link" href="#">View Payslips</a></li>
-     <li class="nav-item"><a class="nav-link" href="{% url 'add_leave' %}">Apply for Leave</a></li>
-                                    <li class="nav-item"><a class="nav-link" href="#">Payment History</a></li>
+
+                                    <li class="nav-item"><a class="nav-link" href="{% url 'employee_payslip' %}"> View Payslips</a></li>
+                                    <li class="nav-item"><a class="nav-link" href="{% url 'add_leave' %}">Apply for Leave</a></li>
+                                    <li class="nav-item"><a class="nav-link" href="{% url 'payment_history' %}">Payment History</a></li>
                                     <li class="nav-item"><a class="nav-link" href="{% url 'submit_feedback' %}">Send Feedback</a></li>
                                     <li class="nav-item"><a class="nav-link" href="{% url 'view_notifications' %}">Notifications</a></li>
                                     <li class="nav-item"><a class="nav-link" href="{% url 'edit_profile' %}">Profile</a></li>
@@ -73,8 +75,7 @@
                             <li class="nav-item"><a class="nav-link" href="{% url 'views_pay_salary' %}">Manage Taxes and Deductions</a></li>
                             <li class="nav-item dropdown">
   <a class="nav-link dropdown-toggle" href="#" id="reportDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
-    Reports
-  </a>
+    Reports   </a>
   <ul class="dropdown-menu" aria-labelledby="reportDropdown">
     <li><a class="dropdown-item" href="{% url 'payroll_summary' %}">Payroll Report</a></li>
     <li><a class="dropdown-item" href="{% url 'tax_deduction_report' %}">Taxes and Deduction Report</a></li>
Index: user/views.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import random\r\nimport string\r\nfrom datetime import date\r\n\r\nfrom django.contrib import messages, auth\r\nfrom django.contrib.auth.decorators import login_required\r\nfrom django.contrib.auth.hashers import make_password\r\nfrom django.core.mail import send_mail\r\nfrom django.http import HttpResponseForbidden\r\nfrom django.shortcuts import render, redirect, get_object_or_404\r\nfrom django.contrib.auth import login as auth_login, get_user_model\r\nfrom django.utils import timezone\r\nfrom django.views.decorators.http import require_POST\r\n\r\nfrom employee.models import Employee\r\nfrom user.forms import UserLoginForm, AddUserForm, UserProfileForm, FeedbackForm\r\nfrom user.models import User, Notification, Feedback\r\n\r\n\r\n# Create your views here.\r\n\r\ndef home(request):\r\n    return render(request, 'home.html')\r\n\r\n\r\ndef login(request):\r\n    if request.method == 'POST':\r\n        form = UserLoginForm(request, data=request.POST)\r\n        if form.is_valid():\r\n            user = form.get_user()\r\n            if not user.is_active:\r\n                messages.error(request, \"Your account has been blocked. Contact admin.\")\r\n                return redirect('login')\r\n            auth_login(request, user)\r\n            if user.is_superuser or user.role == \"admin\":\r\n                return redirect('admin_home')\r\n            elif user.role == \"employee\":\r\n                return redirect('e_home')\r\n            elif user.role == \"hr_manager\":\r\n                return redirect('h_home')\r\n            elif user.role == \"payroll_manager\":\r\n                return redirect('pr_home')\r\n            else:\r\n                messages.error(request, \"Unknown user role. Contact admin.\")\r\n                return redirect('login')\r\n        else:\r\n            messages.error(request, \"Invalid username or password\")\r\n    else:\r\n        form = UserLoginForm()\r\n    return render(request, 'login.html', {'form': form})\r\n\r\n\r\ndef reset_password(request):\r\n    if request.method == 'POST':\r\n        username = request.POST.get('username')\r\n        phone = request.POST.get('phone')\r\n        new_pw = request.POST.get('new_password')\r\n        confirm_pw = request.POST.get('confirm_password')\r\n        try:\r\n            user = User.objects.get(username=username, phone=phone)\r\n            if new_pw != confirm_pw:\r\n                messages.error(request, \"Passwords do not match.\")\r\n                return redirect('reset_password')\r\n            user.set_password(new_pw)\r\n            user.save()\r\n            messages.success(request, \"Password reset successful. Please login with your new password.\")\r\n            return redirect('login')\r\n        except User.DoesNotExist:\r\n            messages.error(request, \"Invalid username or phone number.\")\r\n            return redirect('reset_password')\r\n    return render(request, 'reset_password.html')\r\n\r\n\r\ndef admin_home(request):\r\n    return render(request, 'admin_home.html')\r\n\r\n\r\ndef e_home(request):\r\n    notifications = Notification.objects.filter(user=request.user).order_by('-created_at')[:5]\r\n    return render(request, 'e_home.html', {\r\n        'notifications': notifications})\r\n\r\n\r\ndef h_home(request):\r\n    return render(request, 'h_home.html')\r\n\r\n\r\ndef pr_home(request):\r\n    notifications = Notification.objects.filter(user=request.user).order_by('-created_at')[:5]\r\n    return render(request, 'pr_home.html', {'notifications': notifications})\r\n\r\n\r\ndef about_us(request):\r\n    return render(request, 'about_us.html')\r\n\r\n\r\ndef contact_us(request):\r\n    return render(request, 'contact_us.html')\r\n\r\n\r\ndef logout(request):\r\n    auth.logout(request)\r\n    return redirect('home')\r\n\r\n\r\ndef manage_users(request):\r\n    u = User.objects.exclude(role='admin').exclude(is_superuser=True)\r\n\r\n    # Filtering logic\r\n    role_filter = request.GET.get('role')\r\n    status_filter = request.GET.get('status')\r\n\r\n    if role_filter:\r\n        u = u.filter(role=role_filter)\r\n    if status_filter == 'active':\r\n        u = u.filter(is_active=True)\r\n    elif status_filter == 'blocked':\r\n        u = u.filter(is_active=False)\r\n    elif status_filter == 'approved':\r\n        u = u.filter(is_approved=True)\r\n\r\n    return render(request, 'manage_users.html', {\r\n        'u': u,\r\n        'role_filter': role_filter,\r\n        'status_filter': status_filter\r\n    })\r\n\r\n\r\n@require_POST\r\ndef toggle_user_status(request, user_id):\r\n    user = get_object_or_404(User, id=user_id)\r\n    user.is_active = not user.is_active\r\n    user.save()\r\n    messages.success(request, f\"{user.first_name} {user.last_name}'s account status updated.\")\r\n    return redirect('manage_users')\r\n\r\n\r\n@require_POST\r\ndef delete_user(request, user_id):\r\n    user = get_object_or_404(User, id=user_id)\r\n    user.delete()\r\n    messages.success(request, f\"User {user.first_name} deleted successfully.\")\r\n    return redirect('manage_users')\r\n\r\n\r\ndef generate_username(first_name):\r\n    base = f\"{first_name}\".lower().replace(\" \", \"\")\r\n    suffix = random.randint(100, 999)\r\n    return f\"{base}{suffix}\"\r\n\r\n\r\ndef generate_password():\r\n    chars = string.ascii_letters + string.digits + \"@$!#%\"\r\n    return ''.join(random.choice(chars) for _ in range(8))\r\n\r\n\r\ndef add_user(request):\r\n    if request.method == 'POST':\r\n        form = AddUserForm(request.POST)\r\n        if form.is_valid():\r\n            user = form.save(commit=False)\r\n\r\n            # Auto-generate username & password\r\n            user.username = generate_username(user.first_name)\r\n            raw_password = generate_password()\r\n            user.password = make_password(raw_password)\r\n\r\n            # Generate office email\r\n            domain = \"quickpay.com\"\r\n            user.office_mail = f\"{user.username}@{domain}\"\r\n\r\n            user.save()\r\n            send_mail(\r\n                subject=\"Welcome to QuickPay Payroll System\",\r\n                message=(\r\n                    f\"Dear {user.first_name} {user.last_name},\\n\\n\"\r\n                    f\"Your QuickPay account has been created.\\n\"\r\n                    f\"Username: {user.username}\\n\"\r\n                    f\"Office Email: {user.office_mail}\\n\"\r\n                    f\"Password: {raw_password}\\n\\n\"\r\n                    f\"Please log in and change your password.\\n\\n\"\r\n                    f\"- QuickPay Admin\"\r\n                ),\r\n                from_email=\"no-reply@quickpay.com\",\r\n                recipient_list=[user.email],\r\n                fail_silently=True,\r\n            )\r\n\r\n            messages.success(request, \"User added successfully and credentials emailed.\")\r\n            return redirect('admin_home')\r\n    else:\r\n        form = AddUserForm()\r\n\r\n    return render(request, 'reg.html', {'form': form})\r\n\r\n\r\ndef edit_profile(request):\r\n    if not request.user.is_authenticated:\r\n        messages.error(request, \"You must be logged in to edit your profile.\")\r\n        return redirect(\"login\")\r\n\r\n    user = request.user\r\n    employee = getattr(user, \"employee_profile\", None)\r\n\r\n    if request.method == \"POST\":\r\n        form = UserProfileForm(request.POST, instance=user)\r\n        if form.is_valid():\r\n            # Save the user data\r\n            old_password = user.password\r\n            updated_user = form.save()\r\n\r\n            if form.cleaned_data.get(\"password\") and updated_user.password != old_password:\r\n                logout(request)\r\n                messages.success(request, \"Password changed successfully. Please log in again.\")\r\n                return redirect(\"login\")\r\n            create_notification(\r\n                user=user,\r\n                message=f\"Profile edited successfully\"\r\n            )\r\n            messages.success(request, \"Profile updated successfully.\")\r\n\r\n            # Redirect based on the user role\r\n            if user.role == \"admin\":\r\n                return redirect(\"admin_home\")\r\n            elif user.role == \"hr_manager\":\r\n                return redirect(\"hr_home\")\r\n            elif user.role == \"payroll_manager\":\r\n                return redirect(\"pr_home\")\r\n            elif user.role == \"employee\":\r\n                return redirect(\"e_home\")\r\n            else:\r\n                return redirect(\"home\")\r\n    else:\r\n        form = UserProfileForm(instance=user)\r\n\r\n    return render(request, \"edit_profile.html\", {\r\n        \"form\": form,\r\n        \"employee\": employee\r\n    })\r\n\r\n\r\ndef submit_feedback(request):\r\n    if request.method == 'POST':\r\n        form = FeedbackForm(request.POST)\r\n        if form.is_valid():\r\n            feedback = form.save(commit=False)\r\n            feedback.user = request.user\r\n            feedback.save()\r\n            create_notification(\r\n                roles=['admin', 'hr_manager'],\r\n                message=f\"A feedback has been submitted by {request.user.username}.\"\r\n            )\r\n            create_notification(\r\n                user=feedback.user,\r\n                message=\"Your feedback has been submitted successfully.\"\r\n            )\r\n            return redirect('feedback_success')\r\n    else:\r\n        form = FeedbackForm()\r\n    return render(request, 'submit_feedback.html', {'form': form})\r\n\r\n\r\ndef feedback_list(request):\r\n    if request.user.is_superuser or request.user.groups.filter(name__in=['Admin', 'HR Manager']).exists():\r\n        feedbacks = Feedback.objects.all().order_by('-submitted_on')\r\n    else:\r\n        feedbacks = Feedback.objects.filter(user=request.user)\r\n    return render(request, 'feedback_list.html', {'feedbacks': feedbacks})\r\n\r\n\r\ndef update_feedback_status(request, pk):\r\n    if (\r\n            request.user.is_superuser\r\n            or request.user.groups.filter(name='HR Manager').exists()\r\n    ):\r\n        feedback = get_object_or_404(Feedback, pk=pk)\r\n        feedback.status = 'Reviewed'\r\n        feedback.save()\r\n\r\n        create_notification(\r\n            user=feedback.user,\r\n            message=f\"Your feedback titled '{feedback.title}' has been reviewed.\"\r\n        )\r\n\r\n        return redirect('feedback_list')\r\n    else:\r\n        return HttpResponseForbidden(\"You are not authorized to perform this action.\")\r\n\r\n\r\ndef create_notification(user=None, role=None, roles=None, message=\"\"):\r\n    \"\"\"\r\n    Create notifications for:\r\n    - a single user (user)\r\n    - all users of a given role (role)\r\n    - or multiple roles (roles: list or tuple)\r\n    \"\"\"\r\n    if not message.strip():\r\n        return\r\n\r\n    from django.contrib.auth import get_user_model\r\n    User = get_user_model()\r\n\r\n    if user:\r\n        Notification.objects.create(user=user, message=message)\r\n\r\n    elif role:\r\n        recipients = User.objects.filter(role=role, is_active=True)\r\n        for recipient in recipients:\r\n            Notification.objects.create(user=recipient, message=message)\r\n\r\n    elif roles:\r\n        recipients = User.objects.filter(role__in=roles, is_active=True)\r\n        for recipient in recipients:\r\n            Notification.objects.create(user=recipient, message=message)\r\n\r\n\r\ndef view_notifications(request):\r\n    \"\"\"Show only the notifications that belong to the logged-in user.\"\"\"\r\n    notifications = Notification.objects.filter(user=request.user).order_by('-created_at')\r\n    return render(request, 'notifications.html', {'notifications': notifications})\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/user/views.py b/user/views.py
--- a/user/views.py	(revision d6f29e3645c12fdfbf321dd5eba251052fa69baf)
+++ b/user/views.py	(date 1762254534693)
@@ -262,7 +262,7 @@
 
 def feedback_list(request):
     if request.user.is_superuser or request.user.groups.filter(name__in=['Admin', 'HR Manager']).exists():
-        feedbacks = Feedback.objects.all().order_by('-submitted_on')
+        feedbacks = Feedback.objects.all().order_by('-created_on')
     else:
         feedbacks = Feedback.objects.filter(user=request.user)
     return render(request, 'feedback_list.html', {'feedbacks': feedbacks})
Index: Templates/admin_home.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>{% extends \"layout.html\" %}\r\n{% load static %}\r\n{% block extra_head %}\r\n  <title>Admin Home</title>\r\n{% endblock %}\r\n\r\n\r\n{% block content %}\r\n<div class=\"row\">\r\n\r\n    <!-- \uD83D\uDD39 Left Nav-Bar & News -->\r\n    <div class=\"col-md-8\">\r\n <div class=\"mb-3\">\r\n  <nav class=\"nav flex-column bg-light p-3 rounded shadow-sm\">\r\n  <a href=\"{% url 'manage_users' %}\" class=\"nav-link\">Manage Users</a>\r\n\r\n  <a class=\"nav-link fw-bold\" data-bs-toggle=\"collapse\" href=\"#taxMenu\" role=\"button\" aria-expanded=\"false\" aria-controls=\"taxMenu\">\r\n    Manage Taxes and Deductions\r\n  </a>\r\n  <div class=\"collapse ms-3\" id=\"taxMenu\">\r\n    <a href=\"{% url 'view_pay_salary' %}\" class=\"nav-link small text-secondary\">View Allowances & Deductions</a>\r\n    <a href=\"{% url 'get_pay_salary' %}\" class=\"nav-link small text-secondary\">Add New Allowances & Deductions</a>\r\n  </div>\r\n\r\n  <a href=\"{% url 'feedback_list' %}\" class=\"nav-link\">View Feedbacks</a>\r\n  <a href=\"{% url 'logout' %}\" class=\"nav-link text-danger\" onclick=\"return confirm('Are you sure?')\">Logout</a>\r\n</nav>\r\n\r\n      </div>\r\n      <div class=\"card shadow-sm mb-3\">\r\n        <div class=\"card-header bg-primary text-white\">Company News</div>\r\n        <div class=\"card-body\">\r\n          <div class=\"row\">\r\n            <div class=\"col-md-6 mb-3\">\r\n              <img src=\"{% static 'Copilot_20251003_152228.png' %}\" class=\"img-fluid rounded mb-2\">\r\n              <p class=\"small\">\uD83D\uDCE2 HR announces new wellness program starting next week.</p>\r\n            </div>\r\n            <div class=\"col-md-6 mb-3\">\r\n              <img src=\"{% static 'Copilot_20251003_152901.png' %}\" class=\"img-fluid rounded mb-2\">\r\n              <p class=\"small\">\uD83C\uDF89 Congratulations to Sales Team for exceeding Q3 targets!</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n      <div class=\"col-md-4\">\r\n\r\n      <!-- Live Clock -->\r\n      <div class=\"card text-center shadow-sm mb-3\">\r\n        <div class=\"card-header bg-secondary text-white\"></div>\r\n        <div class=\"card-body\">\r\n          <h3 id=\"clock\"></h3>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Calendar -->\r\n      <div class=\"card shadow-sm\">\r\n        <div class=\"card-header bg-info text-white\">\uD83D\uDCC5 Calendar</div>\r\n        <div class=\"card-body\">\r\n          <div id=\"calendar\"></div>\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n</div>\r\n{% endblock %}\r\n{% block scripts %}\r\n<script>\r\n  // \uD83D\uDD39 Live Clock\r\n  function updateClock() {\r\n    const now = new Date();\r\n    document.getElementById(\"clock\").innerText =\r\n      now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });\r\n  }\r\n  setInterval(updateClock, 1000);\r\n  updateClock();\r\n\r\n  // \uD83D\uDD39 Calendar with weekends highlighted\r\n  function generateCalendar() {\r\n    const today = new Date();\r\n    const month = today.toLocaleString('default', { month: 'long' });\r\n    const year = today.getFullYear();\r\n    const firstDay = new Date(year, today.getMonth(), 1).getDay();\r\n    const daysInMonth = new Date(year, today.getMonth() + 1, 0).getDate();\r\n\r\n    let html = `<h5 class=\"text-center\">${month} ${year}</h5>\r\n                <table class=\"table table-bordered text-center\">\r\n                <tr>`;\r\n\r\n    const days = [\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"];\r\n    for (let d of days) html += `<th>${d}</th>`;\r\n    html += \"</tr><tr>\";\r\n\r\n    // Empty cells before first day\r\n    for (let i = 0; i < firstDay; i++) html += \"<td></td>\";\r\n\r\n    // Days of month\r\n    for (let day = 1; day <= daysInMonth; day++) {\r\n      const currentDay = new Date(year, today.getMonth(), day).getDay(); // 0 = Sun, 6 = Sat\r\n      let cellClass = \"\";\r\n\r\n      // Highlight weekends\r\n      if (currentDay === 0 || currentDay === 6) {\r\n        cellClass = \"bg-danger text-white\";\r\n      }\r\n      // Highlight today\r\n      if (day === today.getDate()) {\r\n        cellClass = \"bg-warning fw-bold\";\r\n      }\r\n\r\n      html += `<td class=\"${cellClass}\">${day}</td>`;\r\n\r\n      if ((firstDay + day) % 7 === 0) html += \"</tr><tr>\";\r\n    }\r\n\r\n    html += \"</tr></table>\";\r\n    document.getElementById(\"calendar\").innerHTML = html;\r\n  }\r\n\r\n  generateCalendar();\r\n</script>\r\n{% endblock %}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Templates/admin_home.html b/Templates/admin_home.html
--- a/Templates/admin_home.html	(revision d6f29e3645c12fdfbf321dd5eba251052fa69baf)
+++ b/Templates/admin_home.html	(date 1762254428221)
@@ -21,7 +21,7 @@
     <a href="{% url 'view_pay_salary' %}" class="nav-link small text-secondary">View Allowances & Deductions</a>
     <a href="{% url 'get_pay_salary' %}" class="nav-link small text-secondary">Add New Allowances & Deductions</a>
   </div>
-
+    <a class="nav-link" href="{% url 'admin_analytics' %}">Admin Dashboard</a>
   <a href="{% url 'feedback_list' %}" class="nav-link">View Feedbacks</a>
   <a href="{% url 'logout' %}" class="nav-link text-danger" onclick="return confirm('Are you sure?')">Logout</a>
 </nav>
Index: Templates/e_home.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>{% extends \"layout.html\" %}\r\n{% load static %}\r\n{% block title %}Employee | Dashboard | QuickPay{% endblock %}\r\n\r\n{% block content %}\r\n<div class=\"container-fluid p-3\">\r\n  \r\n  <!-- \uD83D\uDD39 Top Scrolling Info -->\r\n  <div class=\"bg-dark text-white py-2 px-3 mb-3 rounded\">\r\n  {% if notifications %}\r\n    <marquee behavior=\"scroll\" direction=\"left\">\r\n      {% for note in notifications %}\r\n        \uD83D\uDD14 {{ note.message }} ({{ note.created_at|date:\"M d, H:i\" }}) &nbsp;&nbsp;&nbsp;\r\n      {% endfor %}\r\n    </marquee>\r\n  {% else %}\r\n    <p class=\"m-0 text-center\">No new notifications</p>\r\n  {% endif %}\r\n</div>\r\n\r\n  <div class=\"row\">\r\n    \r\n    <!-- \uD83D\uDD39 Left Nav-Bar & News -->\r\n    <div class=\"col-md-8\">\r\n      \r\n      <!-- Sidebar Menu -->\r\n      <div class=\"mb-3\">\r\n        <nav class=\"nav flex-column bg-light p-3 rounded shadow-sm\">\r\n          <a class=\"nav-link\" href=\"{% url 'view_payslips' %}\"> Payslips</a>\r\n          <a class=\"nav-link\" href=\"{% url 'add_leave' %}\">Apply Leave</a>\r\n          <a class=\"nav-link\" href=\"#\">Payment History</a>\r\n          <a class=\"nav-link\" href=\"{% url 'submit_feedback' %}\">Send Feedback</a>\r\n          <a class=\"nav-link\" href=\"{% url 'edit_profile' %}\"> Profile</a>\r\n          <a class=\"nav-link\" href=\"{% url 'view_notifications' %}\">Notifications</a>\r\n          <a class=\"nav-link\" href=\"{% url 'logout' %}\" onclick=\"return confirm('Are you sure?')\">Logout</a>\r\n        </nav>\r\n      </div>\r\n\r\n      <!-- News / Updates -->\r\n      <div class=\"card shadow-sm mb-3\">\r\n        <div class=\"card-header bg-primary text-white\">Company News</div>\r\n        <div class=\"card-body\">\r\n          <div class=\"row\">\r\n            <div class=\"col-md-6 mb-3\">\r\n              <img src=\"{% static 'Copilot_20251003_152228.png' %}\" class=\"img-fluid rounded mb-2\">\r\n              <p class=\"small\">\uD83D\uDCE2 HR announces new wellness program starting next week.</p>\r\n            </div>\r\n            <div class=\"col-md-6 mb-3\">\r\n              <img src=\"{% static 'Copilot_20251003_152901.png' %}\" class=\"img-fluid rounded mb-2\">\r\n              <p class=\"small\">\uD83C\uDF89 Congratulations to Sales Team for exceeding Q3 targets!</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    \r\n    <!-- \uD83D\uDD39 Right Side: Clock & Calendar -->\r\n    <div class=\"col-md-4\">\r\n      \r\n      <!-- Live Clock -->\r\n      <div class=\"card text-center shadow-sm mb-3\">\r\n        <div class=\"card-header bg-secondary text-white\"></div>\r\n        <div class=\"card-body\">\r\n          <h3 id=\"clock\"></h3>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Calendar -->\r\n      <div class=\"card shadow-sm\">\r\n        <div class=\"card-header bg-info text-white\">\uD83D\uDCC5 Calendar</div>\r\n        <div class=\"card-body\">\r\n          <div id=\"calendar\"></div>\r\n        </div>\r\n      </div>\r\n      \r\n    </div>\r\n  </div>\r\n</div>\r\n{% endblock %}\r\n\r\n{% block scripts %}\r\n<script>\r\n  // \uD83D\uDD39 Live Clock\r\n  function updateClock() {\r\n    const now = new Date();\r\n    document.getElementById(\"clock\").innerText = \r\n      now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });\r\n  }\r\n  setInterval(updateClock, 1000);\r\n  updateClock();\r\n\r\n  // \uD83D\uDD39 Calendar with weekends highlighted\r\n  function generateCalendar() {\r\n    const today = new Date();\r\n    const month = today.toLocaleString('default', { month: 'long' });\r\n    const year = today.getFullYear();\r\n    const firstDay = new Date(year, today.getMonth(), 1).getDay();\r\n    const daysInMonth = new Date(year, today.getMonth() + 1, 0).getDate();\r\n\r\n    let html = `<h5 class=\"text-center\">${month} ${year}</h5>\r\n                <table class=\"table table-bordered text-center\">\r\n                <tr>`;\r\n\r\n    const days = [\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"];\r\n    for (let d of days) html += `<th>${d}</th>`;\r\n    html += \"</tr><tr>\";\r\n\r\n    // Empty cells before first day\r\n    for (let i = 0; i < firstDay; i++) html += \"<td></td>\";\r\n\r\n    // Days of month\r\n    for (let day = 1; day <= daysInMonth; day++) {\r\n      const currentDay = new Date(year, today.getMonth(), day).getDay(); // 0 = Sun, 6 = Sat\r\n      let cellClass = \"\";\r\n\r\n      // Highlight weekends\r\n      if (currentDay === 0 || currentDay === 6) {\r\n        cellClass = \"bg-danger text-white\";\r\n      }\r\n      // Highlight today\r\n      if (day === today.getDate()) {\r\n        cellClass = \"bg-warning fw-bold\";\r\n      }\r\n\r\n      html += `<td class=\"${cellClass}\">${day}</td>`;\r\n\r\n      if ((firstDay + day) % 7 === 0) html += \"</tr><tr>\";\r\n    }\r\n\r\n    html += \"</tr></table>\";\r\n    document.getElementById(\"calendar\").innerHTML = html;\r\n  }\r\n\r\n  generateCalendar();\r\n</script>\r\n{% endblock %}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Templates/e_home.html b/Templates/e_home.html
--- a/Templates/e_home.html	(revision d6f29e3645c12fdfbf321dd5eba251052fa69baf)
+++ b/Templates/e_home.html	(date 1762252670146)
@@ -26,9 +26,9 @@
       <!-- Sidebar Menu -->
       <div class="mb-3">
         <nav class="nav flex-column bg-light p-3 rounded shadow-sm">
-          <a class="nav-link" href="{% url 'view_payslips' %}"> Payslips</a>
+          <a class="nav-link" href="{% url 'employee_payslip' %}"> View Payslips</a>
           <a class="nav-link" href="{% url 'add_leave' %}">Apply Leave</a>
-          <a class="nav-link" href="#">Payment History</a>
+          <a class="nav-link" href="{% url 'payment_history' %}">Payment History</a>
           <a class="nav-link" href="{% url 'submit_feedback' %}">Send Feedback</a>
           <a class="nav-link" href="{% url 'edit_profile' %}"> Profile</a>
           <a class="nav-link" href="{% url 'view_notifications' %}">Notifications</a>
Index: Templates/employee_payslips.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>{% extends 'base.html' %}\r\n{% block content %}\r\n<div class=\"container mt-4\">\r\n    <h4>Your Payslips</h4>\r\n    <table class=\"table table-striped mt-3\">\r\n        <thead>\r\n            <tr>\r\n                <th>Date</th>\r\n                <th>Total Earnings</th>\r\n                <th>Total Deductions</th>\r\n                <th>Net Pay</th>\r\n                <th>Action</th>\r\n            </tr>\r\n        </thead>\r\n        <tbody>\r\n            {% for slip in payslips %}\r\n            <tr>\r\n                <td>{{ slip.generated_date }}</td>\r\n                <td>₹{{ slip.total_earnings }}</td>\r\n                <td>₹{{ slip.total_deductions }}</td>\r\n                <td><strong>₹{{ slip.net_pay }}</strong></td>\r\n                <td>\r\n                    <a href=\"{% url 'generate_payslip_pdf' slip.id %}\" class=\"btn btn-outline-primary btn-sm\">\r\n                        Download PDF\r\n                    </a>\r\n                </td>\r\n            </tr>\r\n            {% endfor %}\r\n        </tbody>\r\n    </table>\r\n</div>\r\n{% endblock %}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Templates/employee_payslips.html b/Templates/employee_payslips.html
--- a/Templates/employee_payslips.html	(revision d6f29e3645c12fdfbf321dd5eba251052fa69baf)
+++ b/Templates/employee_payslips.html	(date 1762250864840)
@@ -1,7 +1,7 @@
 {% extends 'base.html' %}
 {% block content %}
 <div class="container mt-4">
-    <h4>Your Payslips</h4>
+    <h4>Payslips</h4>
     <table class="table table-striped mt-3">
         <thead>
             <tr>
Index: payroll/urls.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from django.urls import path\r\nimport payroll.views\r\n\r\nurlpatterns = [\r\n    path('view_payslips/<int:employee_id>/', payroll.views.view_payslips, name='view_payslips'),\r\n    path('get_pay_salary', payroll.views.get_pay_salary, name='get_pay_salary'),\r\n    path('view_pay_salary', payroll.views.view_pay_salary, name='view_pay_salary'),\r\n    path('edit_common_pay/<int:commonpay_id>/', payroll.views.edit_common_pay, name='edit_common_pay'),\r\n    path('change_pay/<int:commonpay_id>/', payroll.views.change_pay, name='change_pay'),\r\n    path('run_payroll/<int:employee_id>/', payroll.views.run_payroll, name='run_payroll'),\r\n    path('approve_pay/<int:commonpay_id>/', payroll.views.approve_pay, name='approve_pay'),\r\n    path('hr_view_pay', payroll.views.hr_view_pay, name='hr_view_pay'),\r\n    path('generate_payslip_pdf/<int:payslip_id>/', payroll.views.generate_payslip_pdf, name='generate_payslip_pdf'),\r\n    path('views_pay_salary', payroll.views.views_pay_salary, name='views_pay_salary'),\r\n    path('view_payslips', payroll.views.view_payslips, name='view_payslips'),\r\n    path('payment_history', payroll.views.payment_history, name='payment_history'),\r\n    path('views_payslips/<int:employee_id>/', payroll.views.views_payslips, name='views_payslips'),\r\n]
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/payroll/urls.py b/payroll/urls.py
--- a/payroll/urls.py	(revision d6f29e3645c12fdfbf321dd5eba251052fa69baf)
+++ b/payroll/urls.py	(date 1762252478078)
@@ -12,7 +12,10 @@
     path('hr_view_pay', payroll.views.hr_view_pay, name='hr_view_pay'),
     path('generate_payslip_pdf/<int:payslip_id>/', payroll.views.generate_payslip_pdf, name='generate_payslip_pdf'),
     path('views_pay_salary', payroll.views.views_pay_salary, name='views_pay_salary'),
-    path('view_payslips', payroll.views.view_payslips, name='view_payslips'),
+    path('view_payslips/<int:employee_id>/', payroll.views.view_payslips, name='view_payslips'),
     path('payment_history', payroll.views.payment_history, name='payment_history'),
     path('views_payslips/<int:employee_id>/', payroll.views.views_payslips, name='views_payslips'),
-]
\ No newline at end of file
+    path('employee_payslip', payroll.views.employee_payslip, name='employee_payslip'),
+    path('generate_payslip_pdf_hp/<int:payslip_id>/', payroll.views.generate_payslip_pdf_hp, name='generate_payslip_pdf_hp'),
+    ]
+
Index: Templates/view_payslips.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>{% extends 'base.html' %}\r\n{% load static %}\r\n{% block title %}Employee| View Payslip| QuickPay{% endblock %}\r\n{% block content %}\r\n{% if pay %}\r\n<table>\r\n    <thead>\r\n    <tr>\r\n        <th>Total Earnings</th>\r\n        <th>Total Deductions</th>\r\n        <th>Net Pay</th>\r\n        <th>Generated Date</th>\r\n    </tr>\r\n    </thead>\r\n    <tbody>\r\n    {% for i in pay %}\r\n    <tr>\r\n        <td>{{ i.total_earnings }}</td>\r\n        <td>{{ i.total_deductions }}</td>\r\n        <td>{{ i.net_pay }}</td>\r\n        <td>{{ i.generated_date }}</td>\r\n    </tr>\r\n    </tbody>\r\n    {% endfor %}\r\n</table>\r\n<a href=\"{% url 'generate_payslip_pdf' pay.id %}\">Click here to download your payslip till the date{{i.generated_date}}</a>\r\n{% endif %}\r\n{% endblock%}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Templates/view_payslips.html b/Templates/view_payslips.html
--- a/Templates/view_payslips.html	(revision d6f29e3645c12fdfbf321dd5eba251052fa69baf)
+++ b/Templates/view_payslips.html	(date 1762252497732)
@@ -1,6 +1,6 @@
 {% extends 'base.html' %}
 {% load static %}
-{% block title %}Employee| View Payslip| QuickPay{% endblock %}
+{% block title %}HR Manager| View Payslip| QuickPay{% endblock %}
 {% block content %}
 {% if pay %}
 <table>
@@ -23,6 +23,6 @@
     </tbody>
     {% endfor %}
 </table>
-<a href="{% url 'generate_payslip_pdf' pay.id %}">Click here to download your payslip till the date{{i.generated_date}}</a>
+<a href="{% url 'generate_payslip_pdf_hp' pay.id %}">Click to download {{i.employee.user.username}}'s payslip till the date{{i.generated_date}}</a>
 {% endif %}
 {% endblock%}
\ No newline at end of file
Index: .env
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>EMAIL_HOST_USER=\r\nEMAIL_HOST_PASSWORD=\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.env b/.env
--- a/.env	(revision d6f29e3645c12fdfbf321dd5eba251052fa69baf)
+++ b/.env	(date 1762250378581)
@@ -1,2 +1,2 @@
-EMAIL_HOST_USER=
-EMAIL_HOST_PASSWORD=
+EMAIL_HOST_USER=mkarotte128@gmail.com
+EMAIL_HOST_PASSWORD=lyupqjdnnonqvfij
Index: payroll/views.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from datetime import date\r\nfrom decimal import Decimal\r\n\r\nfrom django.contrib import messages\r\nfrom django.contrib.auth.models import Group\r\nfrom django.db.models import Sum\r\nfrom django.http import HttpResponse\r\nfrom django.shortcuts import render, get_object_or_404, redirect\r\nfrom reportlab.lib.pagesizes import A4\r\nfrom reportlab.pdfgen import canvas\r\n\r\nfrom employee.models import Employee, LeaveRequest, PerformanceReview\r\nfrom payroll.forms import GetPayElementsForm, EditCommonPayForm, PayrollManagerForm\r\nfrom payroll.models import Payslip, CommonPay, Payroll, GrossSalary, TotalDeductions, TaxDeduction\r\nfrom user.models import Notification\r\nfrom user.views import create_notification\r\n\r\n\r\n# Create your views here.\r\n\r\ndef get_pay_salary(request):\r\n    if request.method == 'POST':\r\n        form = GetPayElementsForm(request.POST)\r\n        if form.is_valid():\r\n            form.save()\r\n            messages.success(request, \"Common allowances, tax and deduction details added successfully!\")\r\n            create_notification(\r\n                roles=['hr_manager', 'payroll_manager'],\r\n                message=f\"Common allowances, taxes and deductions according to government has been added \"\r\n            )\r\n            return redirect('view_pay_salary')\r\n    else:\r\n        form = GetPayElementsForm()\r\n    return render(request, 'get_pay_salary.html', {'form': form})\r\n\r\n\r\ndef view_pay_salary(request):\r\n    cp = CommonPay.objects.order_by('-updated_on').first()\r\n    return render(request, 'view_pay_salary.html', {'cp': cp})\r\n\r\n\r\ndef edit_common_pay(request, commonpay_id):\r\n    common_pay = get_object_or_404(CommonPay, id=commonpay_id)\r\n    if request.method == 'POST':\r\n        form = EditCommonPayForm(request.POST, instance=common_pay)\r\n        if form.is_valid():\r\n            form.save()\r\n            create_notification(\r\n                roles=['hr_manager', 'payroll_manager'],\r\n                message=f\"Admin has edited common allowances, taxes and deductions.\"\r\n            )\r\n            messages.success(request, \"Common allowances, taxes and deductions updated successfully.\")\r\n            return redirect('view_pay_salary')\r\n    else:\r\n        form = EditCommonPayForm(instance=common_pay)\r\n    return render(request, 'edit_common_pay.html', {'form': form})\r\n\r\n\r\ndef hr_view_pay(request):\r\n    cp = CommonPay.objects.order_by('-updated_on').first()\r\n    return render(request, 'hr_view_pay.html', {'cp': cp})\r\n\r\n\r\ndef approve_pay(request, commonpay_id):\r\n    common_pay = get_object_or_404(CommonPay, id=commonpay_id)\r\n    common_pay.status = 'Approved'\r\n    common_pay.save()\r\n    create_notification(\r\n        role='admin',\r\n        message=f\"Common allowances, taxes and deductions are approved by the HR Manager\"\r\n    )\r\n    messages.success(request, f\"Common Pay effective from {common_pay.effective_from} has been approved.\")\r\n    return redirect('hr_view_pay')\r\n\r\n\r\ndef change_pay(request, commonpay_id):\r\n    common_pay = get_object_or_404(CommonPay, id=commonpay_id)\r\n    if request.method == 'POST':\r\n        reason = request.POST.get('reason', '').strip()\r\n        if not reason:\r\n            messages.error(request, \"Please provide a reason for the change request.\")\r\n            return render(request, 'change_pay.html', {'common_pay': common_pay})\r\n        common_pay.status = 'Edit Requested'\r\n        common_pay.save()\r\n        admin_group = Group.objects.filter(name='Admin').first()\r\n        payroll_group = Group.objects.filter(name='Payroll Manager').first()\r\n        recipients = []\r\n        if admin_group:\r\n            recipients += list(admin_group.user_set.all())\r\n        if payroll_group:\r\n            recipients += list(payroll_group.user_set.all())\r\n        for user in recipients:\r\n            create_notification(\r\n                role='admin',\r\n                message=(\r\n                    f\"HR has requested a change for Common Pay (Effective from {common_pay.effective_from}). \"\r\n                    f\"Reason: {reason}\"\r\n                )\r\n            )\r\n        messages.success(\r\n            request,\r\n            f\"Change request sent for {common_pay.effective_from} with reason: {reason}\"\r\n        )\r\n        return redirect('hr_view_pay')\r\n    return render(request, 'change_pay.html', {'common_pay': common_pay})\r\n\r\n\r\ndef run_payroll(request, employee_id):\r\n    employee = get_object_or_404(Employee, id=employee_id)\r\n    today = date.today()\r\n\r\n    common_pay = CommonPay.objects.filter(status='Approved').order_by('-effective_from').first()\r\n    if not common_pay:\r\n        messages.error(request, \"No approved Common Pay rules available.\")\r\n        return redirect('view_employees')\r\n\r\n    unpaid_leaves = LeaveRequest.objects.filter(\r\n        em=employee,\r\n        status='approved',\r\n        type='unpaid',\r\n        start_date__month=today.month,\r\n        start_date__year=today.year\r\n    )\r\n    unpaid_days = sum((leave.end_date - leave.start_date).days + 1 for leave in unpaid_leaves)\r\n    total_days = 30\r\n    per_day_salary = employee.salary / total_days if employee.salary else 0\r\n\r\n    latest_review = (\r\n        PerformanceReview.objects.filter(employee=employee)\r\n        .order_by('-review_date')\r\n        .first()\r\n    )\r\n\r\n    if latest_review:\r\n        performance_bonus = (employee.salary * latest_review.increment_percentage) / 100\r\n    else:\r\n        performance_bonus = Decimal(0.0)\r\n\r\n    if request.method == 'POST':\r\n        form = PayrollManagerForm(request.POST)\r\n        if form.is_valid():\r\n            basic_pay = employee.salary\r\n            other_allowances = form.cleaned_data.get('other_allowances') or Decimal(0.0)\r\n            tax_type = form.cleaned_data.get('tax_type')\r\n            tax_amt = form.cleaned_data.get('tax_amt') or Decimal(0.0)\r\n\r\n            da_amount = basic_pay * Decimal(common_pay.da / 100)\r\n            hra_amount = basic_pay * Decimal(common_pay.hra / 100)\r\n            gross_total = basic_pay + da_amount + hra_amount + other_allowances + performance_bonus\r\n\r\n            gross_record = GrossSalary.objects.create(\r\n                employee=employee,\r\n                basic_pay=basic_pay,\r\n                da_amount=da_amount,\r\n                hra_amount=hra_amount,\r\n                allowances=da_amount + hra_amount + other_allowances + performance_bonus,\r\n                gross_total=gross_total\r\n            )\r\n\r\n            pf_amount = basic_pay * Decimal(common_pay.pf / 100)\r\n            esi_amount = gross_total * Decimal(common_pay.esi / 100) if gross_total <= 21000 else Decimal(0.0)\r\n            leave_deduction = unpaid_days * per_day_salary\r\n\r\n            td = TotalDeductions.objects.create(\r\n                employee=employee,\r\n                pf=pf_amount,\r\n                esi=esi_amount,\r\n                income_tax=tax_amt if tax_type == 'income_tax' else Decimal(0.0),\r\n                gross_salary_amount=gross_total\r\n            )\r\n\r\n            if tax_amt > 0:\r\n                TaxDeduction.objects.create(\r\n                    employee=employee,\r\n                    deduction_summary=td,\r\n                    tax_type=tax_type,\r\n                    tax_amt=tax_amt,\r\n                    applicable_date=today\r\n                )\r\n\r\n            td.total_deduction += leave_deduction\r\n            td.save()\r\n\r\n            net_salary = gross_total - td.total_deduction\r\n\r\n            payroll_record = Payroll.objects.create(\r\n                employee=employee,\r\n                gross=gross_record,\r\n                deductions=td,\r\n                net_salary=net_salary,\r\n                bonuses=performance_bonus\r\n            )\r\n\r\n            Payslip.objects.create(\r\n                employee=employee,\r\n                payroll=payroll_record,\r\n                total_earnings=gross_total,\r\n                total_deductions=td.total_deduction,\r\n                net_pay=net_salary\r\n            )\r\n\r\n            create_notification(\r\n                user=employee.user,\r\n                message=f\"Your payslip for {today.strftime('%B %Y')} has been processed successfully. \"\r\n                        f\"Net Pay: ₹{net_salary}\"\r\n            )\r\n            create_notification(\r\n                role='hr_manager',\r\n                message=f\"Payslip for employee ID {employee_id} has been generated.\"\r\n            )\r\n\r\n            messages.success(\r\n                request,\r\n                f\"Payroll generated for {employee.user.get_username()} | Unpaid leaves: {unpaid_days}\"\r\n            )\r\n            return redirect('view_payslips', employee_id=employee.id)\r\n\r\n    else:\r\n        form = PayrollManagerForm()\r\n\r\n    summary = {\r\n        'unpaid_days': unpaid_days,\r\n        'per_day_salary': per_day_salary,\r\n    }\r\n\r\n    return render(request, 'payroll_entry.html', {\r\n        'form': form,\r\n        'employee': employee,\r\n        'common_pay': common_pay,\r\n        'summary': summary,\r\n        'performance_bonus': performance_bonus,\r\n    })\r\n\r\n\r\ndef view_payslips(request):\r\n    em = request.user\r\n    pay = Payslip.objects.filter(employee_id=em).order_by('-generated_date')\r\n    return render(request, 'view_payslips.html', {'pay': pay})\r\n\r\n\r\n\"\"\"def view_payroll_summary(request):\r\n    payrolls = Payroll.objects.select_related('employee', 'gross', 'deductions').order_by('-payment_date')\r\n    return render(request, 'view_payroll_summary.html', {'payrolls': payrolls})\r\n\"\"\"\r\n\r\n\r\ndef generate_payslip_pdf(request, payslip_id):\r\n    payslip = get_object_or_404(Payslip, id=payslip_id)\r\n    payroll = payslip.payroll\r\n    employee = payslip.employee\r\n    gross = payroll.gross\r\n    deductions = payroll.deductions\r\n    if not (request.user.is_superuser or request.user == employee.user):\r\n        return HttpResponse(\"Unauthorized\", status=403)\r\n    response = HttpResponse(content_type='application/pdf')\r\n    response[\r\n        'Content-Disposition'] = f'attachment; filename=\"Payslip_{employee.user.username}_{payslip.generated_date}.pdf\"'\r\n    p = canvas.Canvas(response, pagesize=A4)\r\n    width, height = A4\r\n    p.setFont(\"Helvetica-Bold\", 18)\r\n    p.drawCentredString(width / 2, height - 80, \"Company Name Pvt. Ltd.\")\r\n    p.setFont(\"Helvetica\", 12)\r\n    p.drawCentredString(width / 2, height - 100, \"Employee Payslip\")\r\n    y = height - 150\r\n    p.setFont(\"Helvetica-Bold\", 12)\r\n    p.drawString(50, y, \"Employee Details\")\r\n    p.setFont(\"Helvetica\", 10)\r\n    y -= 20\r\n    p.drawString(70, y, f\"Name: {employee.user.get_full_name() or employee.user.username}\")\r\n    y -= 15\r\n    p.drawString(70, y, f\"Department: {getattr(employee, 'department', 'N/A')}\")\r\n    y -= 15\r\n    p.drawString(70, y, f\"Date: {payslip.generated_date.strftime('%d-%m-%Y')}\")\r\n    y -= 40\r\n    p.setFont(\"Helvetica-Bold\", 12)\r\n    p.drawString(50, y, \"Earnings\")\r\n    p.setFont(\"Helvetica\", 10)\r\n    y -= 20\r\n    p.drawString(70, y, f\"Basic Pay: ₹{gross.basic_pay}\")\r\n    y -= 15\r\n    p.drawString(70, y, f\"DA: ₹{gross.da_amount}\")\r\n    y -= 15\r\n    p.drawString(70, y, f\"HRA: ₹{gross.hra_amount}\")\r\n    y -= 15\r\n    p.drawString(70, y, f\"Other Allowances: ₹{gross.allowances or 0}\")\r\n    y -= 15\r\n    p.drawString(70, y, f\"Bonuses: ₹{payroll.bonuses or 0}\")\r\n    y -= 40\r\n    p.setFont(\"Helvetica-Bold\", 12)\r\n    p.drawString(50, y, \"Deductions\")\r\n    p.setFont(\"Helvetica\", 10)\r\n    y -= 20\r\n    p.drawString(70, y, f\"PF: ₹{deductions.pf}\")\r\n    y -= 15\r\n    p.drawString(70, y, f\"ESI: ₹{deductions.esi}\")\r\n    y -= 15\r\n    p.drawString(70, y, f\"PT: ₹{deductions.pt}\")\r\n    y -= 15\r\n    p.drawString(70, y, f\"Income Tax: ₹{deductions.income_tax}\")\r\n    y -= 15\r\n    p.drawString(70, y, f\"Total Deductions: ₹{deductions.total_deduction}\")\r\n    y -= 40\r\n    p.setFont(\"Helvetica-Bold\", 12)\r\n    p.drawString(50, y, \"Net Pay\")\r\n    p.setFont(\"Helvetica\", 11)\r\n    y -= 20\r\n    p.drawString(70, y, f\"₹{payslip.net_pay}\")\r\n    p.setFont(\"Helvetica-Oblique\", 9)\r\n    p.drawCentredString(width / 2, 60, \"This is a system-generated payslip and does not require a signature.\")\r\n\r\n    p.showPage()\r\n    p.save()\r\n    messages.success(\r\n        request,\r\n        f\"Payslip downloaded successfully.\"\r\n    )\r\n    return response\r\n\r\n\r\ndef views_pay_salary(request):\r\n    cp = CommonPay.objects.order_by('-updated_on').first()\r\n    return render(request, 'views_pay_salary.html', {'cp': cp})\r\n\r\n\r\ndef payment_history(request):\r\n    if not hasattr(request.user, 'employee_profile'):\r\n        messages.error(request, \"You must be logged in as an employee to view this page.\")\r\n        return redirect('home')\r\n    employee = request.user.employee_profile\r\n    payslips = Payslip.objects.filter(employee=employee).order_by('-generated_date')\r\n    return render(request, 'payment_history.html', {'payslips': payslips})\r\n\r\n\r\ndef views_payslips(request, employee_id):\r\n    pay = Payslip.objects.filter(employee_id=employee_id).order_by('-generated_date')\r\n    return render(request, 'views_payslips.html', {'pay': pay})\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/payroll/views.py b/payroll/views.py
--- a/payroll/views.py	(revision d6f29e3645c12fdfbf321dd5eba251052fa69baf)
+++ b/payroll/views.py	(date 1762253026675)
@@ -202,7 +202,7 @@
             create_notification(
                 user=employee.user,
                 message=f"Your payslip for {today.strftime('%B %Y')} has been processed successfully. "
-                        f"Net Pay: ₹{net_salary}"
+                        f"Net Pay: ₹{net_salary:.2f}"
             )
             create_notification(
                 role='hr_manager',
@@ -232,9 +232,8 @@
     })
 
 
-def view_payslips(request):
-    em = request.user
-    pay = Payslip.objects.filter(employee_id=em).order_by('-generated_date')
+def view_payslips(request, employee_id):
+    pay = Payslip.objects.filter(employee_id=employee_id).order_by('-generated_date')
     return render(request, 'view_payslips.html', {'pay': pay})
 
 
@@ -250,7 +249,10 @@
     employee = payslip.employee
     gross = payroll.gross
     deductions = payroll.deductions
-    if not (request.user.is_superuser or request.user == employee.user):
+    if not (
+            request.user == employee.user
+            or request.user.role in ['hr_manager', 'payroll_manager']
+    ):
         return HttpResponse("Unauthorized", status=403)
     response = HttpResponse(content_type='application/pdf')
     response[
@@ -335,3 +337,83 @@
     pay = Payslip.objects.filter(employee_id=employee_id).order_by('-generated_date')
     return render(request, 'views_payslips.html', {'pay': pay})
 
+
+def employee_payslip(request):
+    employee = get_object_or_404(Employee, user=request.user)
+    payslips = Payslip.objects.filter(employee=employee).order_by('-generated_date')
+    return render(request, 'employee_payslips.html', {'payslips': payslips})
+
+
+def generate_payslip_pdf_hp(request, payslip_id):
+    payslip = get_object_or_404(Payslip, id=payslip_id)
+    payroll = payslip.payroll
+    employee = payslip.employee
+    gross = payroll.gross
+    deductions = payroll.deductions
+    if not (
+            request.user.role in ['hr_manager', 'payroll_manager']
+    ):
+        return HttpResponse("Unauthorized", status=403)
+    response = HttpResponse(content_type='application/pdf')
+    response[
+        'Content-Disposition'] = f'attachment; filename="Payslip_{employee.user.username}_{payslip.generated_date}.pdf"'
+    p = canvas.Canvas(response, pagesize=A4)
+    width, height = A4
+    p.setFont("Helvetica-Bold", 18)
+    p.drawCentredString(width / 2, height - 80, "Company Name Pvt. Ltd.")
+    p.setFont("Helvetica", 12)
+    p.drawCentredString(width / 2, height - 100, "Employee Payslip Manager Copy")
+    y = height - 150
+    p.setFont("Helvetica-Bold", 12)
+    p.drawString(50, y, "Employee Details")
+    p.setFont("Helvetica", 10)
+    y -= 20
+    p.drawString(70, y, f"Name: {employee.user.get_full_name() or employee.user.username}")
+    y -= 15
+    p.drawString(70, y, f"Department: {getattr(employee, 'department', 'N/A')}")
+    y -= 15
+    p.drawString(70, y, f"Date: {payslip.generated_date.strftime('%d-%m-%Y')}")
+    y -= 40
+    p.setFont("Helvetica-Bold", 12)
+    p.drawString(50, y, "Earnings")
+    p.setFont("Helvetica", 10)
+    y -= 20
+    p.drawString(70, y, f"Basic Pay: ₹{gross.basic_pay}")
+    y -= 15
+    p.drawString(70, y, f"DA: ₹{gross.da_amount}")
+    y -= 15
+    p.drawString(70, y, f"HRA: ₹{gross.hra_amount}")
+    y -= 15
+    p.drawString(70, y, f"Other Allowances: ₹{gross.allowances or 0}")
+    y -= 15
+    p.drawString(70, y, f"Bonuses: ₹{payroll.bonuses or 0}")
+    y -= 40
+    p.setFont("Helvetica-Bold", 12)
+    p.drawString(50, y, "Deductions")
+    p.setFont("Helvetica", 10)
+    y -= 20
+    p.drawString(70, y, f"PF: ₹{deductions.pf}")
+    y -= 15
+    p.drawString(70, y, f"ESI: ₹{deductions.esi}")
+    y -= 15
+    p.drawString(70, y, f"PT: ₹{deductions.pt}")
+    y -= 15
+    p.drawString(70, y, f"Income Tax: ₹{deductions.income_tax}")
+    y -= 15
+    p.drawString(70, y, f"Total Deductions: ₹{deductions.total_deduction}")
+    y -= 40
+    p.setFont("Helvetica-Bold", 12)
+    p.drawString(50, y, "Net Pay")
+    p.setFont("Helvetica", 11)
+    y -= 20
+    p.drawString(70, y, f"₹{payslip.net_pay}")
+    p.setFont("Helvetica-Oblique", 9)
+    p.drawCentredString(width / 2, 60, "This is a system-generated payslip and does not require a signature.")
+
+    p.showPage()
+    p.save()
+    messages.success(
+        request,
+        f"Payslip downloaded successfully."
+    )
+    return response
Index: Templates/views_payslips.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>{% extends 'base.html' %}\r\n{% load static %}\r\n{% block title %}HR Manager| View Payslip| QuickPay{% endblock %}\r\n{% block content %}\r\n{% if pay %}\r\n<table>\r\n    <thead>\r\n    <tr>\r\n        <th>Total Earnings</th>\r\n        <th>Total Deductions</th>\r\n        <th>Net Pay</th>\r\n        <th>Generated Date</th>\r\n    </tr>\r\n    </thead>\r\n    <tbody>\r\n    {% for i in pay %}\r\n    <tr>\r\n        <td>{{ i.total_earnings }}</td>\r\n        <td>{{ i.total_deductions }}</td>\r\n        <td>{{ i.net_pay }}</td>\r\n        <td>{{ i.generated_date }}</td>\r\n    </tr>\r\n    </tbody>\r\n    {% endfor %}\r\n</table>\r\n<a href=\"{% url 'generate_payslip_pdf'pay.id %}\">Click here to download the payslip for {{i.employee.user.username}} till the date{{i.generated_date}}</a>\r\n{% endif %}\r\n{% endblock%}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Templates/views_payslips.html b/Templates/views_payslips.html
--- a/Templates/views_payslips.html	(revision d6f29e3645c12fdfbf321dd5eba251052fa69baf)
+++ b/Templates/views_payslips.html	(date 1762252497741)
@@ -1,28 +1,36 @@
 {% extends 'base.html' %}
 {% load static %}
-{% block title %}HR Manager| View Payslip| QuickPay{% endblock %}
+{% block title %}HR Manager | View Payslip | QuickPay{% endblock %}
+
 {% block content %}
 {% if pay %}
-<table>
+<table border="1" cellspacing="0" cellpadding="10">
     <thead>
-    <tr>
-        <th>Total Earnings</th>
-        <th>Total Deductions</th>
-        <th>Net Pay</th>
-        <th>Generated Date</th>
-    </tr>
+        <tr>
+            <th>Total Earnings</th>
+            <th>Total Deductions</th>
+            <th>Net Pay</th>
+            <th>Generated Date</th>
+            <th>Action</th>
+        </tr>
     </thead>
     <tbody>
-    {% for i in pay %}
-    <tr>
-        <td>{{ i.total_earnings }}</td>
-        <td>{{ i.total_deductions }}</td>
-        <td>{{ i.net_pay }}</td>
-        <td>{{ i.generated_date }}</td>
-    </tr>
-    </tbody>
-    {% endfor %}
+        {% for i in pay %}
+        <tr>
+            <td>{{ i.total_earnings }}</td>
+            <td>{{ i.total_deductions }}</td>
+            <td>{{ i.net_pay }}</td>
+            <td>{{ i.generated_date }}</td>
+            <td>
+                <a href="{% url 'generate_payslip_pdf_hp' i.id %}">
+                    Download Payslip
+                </a>
+            </td>
+        </tr>
+        {% endfor %}
+    </tbody>
 </table>
-<a href="{% url 'generate_payslip_pdf'pay.id %}">Click here to download the payslip for {{i.employee.user.username}} till the date{{i.generated_date}}</a>
+{% else %}
+<p>No payslips found.</p>
 {% endif %}
-{% endblock%}
\ No newline at end of file
+{% endblock %}
